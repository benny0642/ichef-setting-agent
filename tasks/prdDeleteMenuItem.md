# deleteMenuItem - 產品需求文件 (PRD)

## 1. 引言/概述

deleteMenuItem 是一個 MCP (Model Context Protocol) 工具，用於安全地刪除餐廳菜單中的商品項目。此工具提供完整的刪除前檢查機制，確保不會因為刪除商品而影響現有的套餐結構或外帶外送服務。該工具遵循現有 createMenuItem 工具的架構設計，提供一致的用戶體驗和錯誤處理機制。

## 2. 目標

- 目標 1：提供安全可靠的商品刪除功能，避免誤刪影響業務運營
- 目標 2：實現智能的刪除前檢查，包含外帶外送狀態和套餐依賴關係驗證
- 目標 3：提供清晰的用戶提示和指導，幫助用戶正確處理刪除限制
- 目標 4：維持與現有 MCP 工具一致的介面和體驗

## 3. 功能需求

### 3.1 核心功能

1. 系統必須接收商品 UUID 作為輸入參數，並驗證 UUID 格式的正確性
2. 系統必須在刪除前查詢商品的完整資訊，包含類型、名稱、外帶外送狀態等
3. 系統必須執行 GraphQL deleteMenuItem mutation 完成實際刪除操作
4. 系統必須在刪除成功後顯示被刪除商品的詳細資訊確認

### 3.2 刪除前安全檢查

1. **外帶外送狀態檢查**：
   - 系統必須檢查所有商品（包含一般商品和套餐商品）的 onlineRestaurantMenuItem 陣列
   - 當陣列不為空時，系統必須阻止刪除並提示用戶先進行下架操作
   - 系統應提供具體的指引，建議用戶使用其他工具進行下架

2. **套餐依賴關係檢查**：
   - 對於一般商品（type: item），系統必須檢查是否為其他套餐的子項目
   - 系統必須特別檢查該商品是否為某個套餐分類中的唯一可選項目
   - 當商品是套餐分類的唯一選項時，系統必須阻止刪除並說明原因

3. **商品存在性驗證**：
   - 系統必須先確認商品存在才能進行刪除操作
   - 對於不存在的 UUID，系統應提供明確的錯誤訊息

### 3.3 用戶介面功能

1. 系統應在執行刪除前顯示確認訊息「哈囉，我要執行了」，保持與 createMenuItem 一致的風格
2. 系統必須提供詳細的成功回應，包含被刪除商品的基本資訊（UUID、名稱、類型、分類等）
3. 系統必須提供友善且具體的錯誤訊息，協助用戶理解問題並提供解決建議

## 4. 非目標 (超出範圍)

- 非目標 1：不包含批量刪除功能
- 非目標 2：不提供軟刪除或還原功能
- 非目標 3：不直接整合外帶外送下架功能
- 非目標 4：不處理商品的歷史訂單記錄影響
- 非目標 5：不包含額外的權限驗證機制

## 5. 設計考量

- **一致性設計**：遵循 createMenuItem 的架構模式，包含參數驗證、錯誤處理和回應格式
- **用戶體驗**：提供清晰的步驟指引和錯誤說明，降低用戶操作困擾
- **安全性設計**：多層檢查機制確保刪除操作的安全性
- **錯誤處理**：採用與 createMenuItem 相同的錯誤分類和處理邏輯

## 6. 技術考量

- **技術架構**：基於現有的 GraphQL 客戶端和 MCP 工具架構
- **GraphQL 整合**：使用 menuItemItemDeleteMutation 執行刪除操作
- **資料查詢**：需要先查詢商品詳細資訊進行檢查，可能需要使用現有的 menuItemQuery
- **套餐依賴檢查**：需要查詢所有套餐商品的 comboItemCategories 結構
- **錯誤處理**：採用與 createMenuItem 相同的錯誤分類邏輯
- **類型安全**：使用 TypeScript 確保參數和回應的類型安全

## 7. 成功指標

- **量化指標**：
  - 刪除操作成功率達到 99% 以上（在通過安全檢查的前提下）
  - 錯誤訊息的準確率達到 100%（正確識別所有阻止刪除的原因）
  - 工具回應時間控制在 3 秒以內

- **質化指標**：
  - 用戶能夠清楚理解刪除失敗的原因和解決方案
  - 工具介面與現有工具保持一致的體驗
  - 商品刪除不會導致套餐結構錯誤或外帶外送服務中斷

## 8. 詳細規格

### 8.1 輸入參數規格

```typescript
interface DeleteMenuItemArgs {
  uuid: string; // 商品 UUID，必填，需符合 UUID 格式
}
```

### 8.2 GraphQL Mutation

```graphql
mutation menuItemItemDeleteMutation($uuid: UUID!) {
  restaurant {
    settings {
      menu {
        deleteMenuItem(uuid: $uuid) {
          uuid
        }
      }
    }
  }
}
```

### 8.3 檢查流程

1. **參數驗證**：驗證 UUID 格式
2. **商品查詢**：查詢商品詳細資訊
3. **外帶外送檢查**：檢查 onlineRestaurantMenuItem 陣列
4. **套餐依賴檢查**：查詢是否為其他套餐的必要選項
5. **執行刪除**：通過所有檢查後執行 mutation
6. **回應格式化**：格式化成功或錯誤訊息

### 8.4 錯誤處理類別

- **參數錯誤**：UUID 格式錯誤、缺少必填參數
- **商品不存在**：指定的 UUID 找不到對應商品
- **外帶外送限制**：商品已上架到外帶外送平台
- **套餐依賴限制**：商品是其他套餐的必要選項
- **系統錯誤**：網路連線、認證、權限等技術問題

## 9. 開放問題

- [ ] 是否需要記錄刪除操作的審計日誌
- [ ] 未來是否考慮加入批量刪除功能
- [ ] 是否需要與其他系統（如庫存管理）進行整合檢查
